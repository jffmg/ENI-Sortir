{% extends 'layout.html.twig' %}

{% block title %}Sortir.com | Liste des sorties{% endblock %}

{% block main %}

 {#   {% if app.user %}
        <div class="app-connected-participant">
            Vous êtes connectés en tant que {{ app.user.username }}, <a href="{{ path('user_logout') }}">Déconnexion</a>
        </div>
    {% endif %}#}


    <h1>Filtrer les sorties</h1>
    <div>
        <p>Date du jour : {{ "now"| date("d/m/Y") }}</p>
        <p>Participant : <span class="app-profile-label">{{ app.user.username }}</span></p>
    </div>

    <div class="app-form-search-events">

        {{ form_start(searchEventsForm) }}

        {{ form_widget(searchEventsForm) }}

        <button type="submit">Rechercher</button>

        {{ form_end(searchEventsForm) }}

    </div>

    <table class="app-table">
        <tr>
            <th>Nom de la sortie</th>
            <th>Date de la sortie</th>
            <th>Clotûre</th>
            <th>Inscrits/places</th>
            <th>Etat</th>
            <th>Inscrit</th>
            <th>Organisateur</th>
            <th>Actions</th>
        </tr>

        {% for event in events %}
            <tr>
                <td>{{ event.name }}</td>
                <td>{{ event.dateTimeStart | date("d/m/Y h:i") }}</td>
                <td>{{ event.dateEndInscription  | date("d/m/Y") }}</td>
                <td>{{ event.participants.count }} / {{ event.nbInscriptionsMax }}</td>
                <td>{{ event.state.label }}</td>

                <td>
                    {% for p in event.participants %}
                        {% if app.user == p %}
                            X
                        {% endif %}
                    {% endfor %}
                </td>
                <td>{{ event.organizer.userName }}</td>

                <td>
                    <a class="app-link" href="{{ path('event_detail',{id: event.id}) }}">Afficher</a></td>
                    {% if app.user == event.organizer %}
                     {# TODO Ajouter les fonctionnalités et path modifier / publier #}
                        {% if event.state.label == "" %}
                            <a class="app-link" href="{{ path('main_home') }}">Modifier</a>
                            <a class="app-link" href="{{ path('main_home') }}">Publier</a>
                        {% else %}
                            {# TODO Ajouter condition sur date inscription et faire les fonctionnalités / path corrspondantes #}
                            <a class="app-link" href="{{ path('main_home') }}">Modifier</a>
                            <a class="app-link" href="{{ path('main_home') }}">Annuler</a>
                        {% endif %}
                    {% endif %}

                    {# TODO Ajouter les fonctionnalités et path s'inscrire, se desister #}
                    {% if event.participants.count > 0 %}
                        {% for p in event.participants %}
                            {% if app.user == p %}
                                <a class="app-link" href="{{ path('main_home') }}">Se désister</a>
                            {% else %}
                                <a class="app-link" href="{{ path('main_home') }}">S'inscrire</a>
                            {% endif %}
                        {% endfor %}
                    {% else %}
                        <a class="app-link" href="{{ path('main_home') }}">S'inscrire</a>
                    {% endif %}

                </td>
            </tr>
        {% endfor %}
    </table>

    <a class="app-btn-link" href="{{ path('event_add') }}">Créer une sortie</a>

{% endblock %}